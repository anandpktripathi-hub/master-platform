# --- DOMAIN VERIFICATION SYSTEM: DYNAMIC ROUTING SNIPPET ---
map $host $tenant_id {
    default "";
    # Add tenant domains below (auto-generated or via deployment script)
    # e.g. tenant1.com   tenant-uuid-1;
    #      tenant2.com   tenant-uuid-2;
}

server {
    listen 80;
    server_name ~^(?<domain>.+)$;
    set $tenant $tenant_id;

    # Wildcard SSL (if using certbot or similar)
    # listen 443 ssl;
    # ssl_certificate /etc/letsencrypt/live/$host/fullchain.pem;
    # ssl_certificate_key /etc/letsencrypt/live/$host/privkey.pem;

    location / {
        proxy_set_header X-Tenant $tenant;
        proxy_pass http://backend:3000;
    }
}
